<!DOCTYPE html><html lang="zh-CN"><head><link rel="preconnect" href="https://cdn.laxdu.com" crossorigin=""><link rel="preconnect" href="https://cdn.staticfile.org" crossorigin=""><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#e7ddc8" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#181c27" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/resources/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon/favicon-32.png"><link rel="icon" type="image/png" sizes="16x16" href="/resources/favicon/favicon.ico"><meta name="google-site-verification" content="qrfHdjHo8d6tPJTdX-b5IScRX0L1lgZk7ikpMOFlzrc"><meta name="baidu-site-verification" content="codeva-z6LkdLbjuo"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"blog.laxdu.com","root":"/","images":"/resources/img/","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":true,"sidebar":{"position":"left","width_expanded":240,"width_dual_column":240,"display":"post","padding":18,"offset":12,"on_mobile":true,"button_reverse":true,"Pisces | Gemini":240},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta property="og:type" content="article"><meta property="og:title" content="UE 5.3 OpenVDB代码浅析"><meta property="og:url" content="https://blog.laxdu.com/posts/202401/index.html"><meta property="og:site_name" content="渡"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/0.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/1.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/2.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/3.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/4.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/5.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/6.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/7.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/8.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/9.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/10.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/11.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/12.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/13.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/14.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/15.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/16.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/17.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/18.webp"><meta property="og:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/19.webp"><meta property="article:published_time" content="2024-01-30T10:36:13.000Z"><meta property="article:author" content="辰"><meta property="article:tag" content="图形"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.laxdu.com/ImageHosting/V/VDB/0.webp"><link rel="canonical" href="https://blog.laxdu.com/posts/202401/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.laxdu.com/posts/202401/","path":"/posts/202401/","title":"UE 5.3 OpenVDB代码浅析"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>UE 5.3 OpenVDB代码浅析 | 渡</title><link rel="stylesheet" href="/resources/fonts/longcang/LongCang-Regular.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">渡</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">静谧中，沉静心灵</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-life"><a href="/life/" rel="section"><i class="fa fa-pizza-slice fa-fw"></i>生活</a></li><li class="menu-item menu-item-leisure"><a href="/leisure/" rel="section"><i class="fa fa-mug-hot fa-fw"></i>余暇</a></li><li class="menu-item menu-item-industry"><a href="/industry/" rel="section"><i class="fa fa-fish fa-fw"></i>工业</a></li><li class="menu-item menu-item-notes"><a href="/notes/" rel="section"><i class="fa fa-book fa-fw"></i>随记</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-splotch fa-fw"></i>留言</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">目 录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5-%E5%AD%98%E5%82%A8"><span class="nav-text">1. 导入&amp;存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E9%A1%B5%E8%A1%A8%E5%92%8CTileData%E6%95%B0%E9%87%8F%E8%AE%BE%E7%BD%AE"><span class="nav-text">1.1 页表和TileData数量设置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-1-PageTable%E6%95%B0%E9%87%8F%E8%AE%BE%E7%BD%AE"><span class="nav-text">1.1.1 PageTable数量设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-2-TileData%E6%95%B0%E9%87%8F%E8%AE%BE%E7%BD%AE"><span class="nav-text">1.1.2 TileData数量设置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E9%A1%B5%E8%A1%A8%E5%8F%8ATilesData%E7%9A%84%E5%8E%8B%E7%BC%A9-%E5%8F%8A%E5%AD%98%E5%82%A8%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE"><span class="nav-text">1.2 页表及TilesData的压缩, 及存储流式数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-%E9%A1%B5%E8%A1%A8%E7%9A%84%E5%8E%8B%E7%BC%A9"><span class="nav-text">1.2.1 页表的压缩</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-TileData%E7%9A%84%E5%8E%8B%E7%BC%A9"><span class="nav-text">1.2.2 TileData的压缩</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-3-%E5%AD%98%E5%82%A8%E6%B5%81%E5%BC%8F%E6%95%B0%E6%8D%AE"><span class="nav-text">1.2.3 存储流式数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BA%B9%E7%90%86"><span class="nav-text">2. 纹理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E8%87%B3RHI"><span class="nav-text">2.1 数据更新至RHI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-%E6%B8%B2%E6%9F%93%E9%A1%B5%E8%A1%A8%E5%8F%8ATile%E7%BA%B9%E7%90%86"><span class="nav-text">2.2 渲染页表及Tile纹理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E9%87%87%E6%A0%B7%E9%A1%B5%E8%A1%A8%E5%8F%8ATile%E7%BA%B9%E7%90%86"><span class="nav-text">2.3 采样页表及Tile纹理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%85%B6%E4%BB%96"><span class="nav-text">3. 其他</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#UE5-3-SVT%E7%9A%84%E4%B8%80%E4%BA%9B%E9%99%90%E5%88%B6"><span class="nav-text">UE5.3 SVT的一些限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%B0%8F%E7%BB%93"><span class="nav-text">4. 小结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%8F%82%E8%80%83"><span class="nav-text">5. 参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="辰" src="/resources/img/avatar-cat.jpg"><p class="site-author-name" itemprop="name">辰</p><div class="site-description" itemprop="description">C'est la vie</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">58</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div></div></div><div class="pjax"><div class="sidebar-inner sidebar-post-related"><div class="animated"><div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i> 相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><a class="popular-posts-link" href="/posts/202415/" rel="bookmark"><time class="popular-posts-time">2024-07-16</time><br>VDB相关阅读资料</a></li></ul></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.laxdu.com/posts/202401/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/resources/img/avatar-cat.jpg"><meta itemprop="name" content="辰"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="渡"><meta itemprop="description" content="C'est la vie"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="UE 5.3 OpenVDB代码浅析 | 渡"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">UE 5.3 OpenVDB代码浅析</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-01-30 18:36:13" itemprop="dateCreated datePublished" datetime="2024-01-30T18:36:13+08:00">2024-01-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/industry/" itemprop="url" rel="index"><span itemprop="name">工业</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/0.webp"></p><span id="more"></span><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><strong>UE官方支持VDB的最低版本是5.3</strong>, 用的是OpenVDB v8.1.0版本（此版本不支持NanoVDB, NanoVDB的支持得在 OpenVDB v9.0.0版本）<br><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/1.webp"></p><p><strong>UE5.0、5.1有第三方插件<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VpZG9zbW9udHJlYWwvdW5yZWFsLXZkYi90cmVlL21haW4=">unreal-vdb<i class="fa fa-external-link-alt"></i></span>支持了OpenVDB及NanoVDB</strong><br><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/2.webp"></p><p><em>接下来分析的是基于UE5.3官方支持的VDB功能</em></p><h3 id="1-导入-存储"><a href="#1-导入-存储" class="headerlink" title="1. 导入&存储"></a>1. 导入&amp;存储</h3><pre class="language-C++" data-language="C++"><code class="language-C++">1. USparseVolumeTextureFactory类, 导入或重导VDB, 包括UAnimatedSparseVolumeTexture及UStaticSparseVolumeTexture
2. 核心导入方法是ConvertOpenVDBToSparseVolumeTexture, 序列和静态VDB都用该方法处理导入
3. 每一个VDB文件都会对应一个FTextureData类实例, 用来缓存导入的数据</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/3.webp"></p><pre class="language-C++" data-language="C++"><code class="language-C++">FSparseVolumeTextureDataProviderOpenVDB, 在Initialize方法里包装了FTextureData创建信息, 而后Create时生成FTextureData</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/4.webp"></p><h4 id="1-1-页表和TileData数量设置"><a href="#1-1-页表和TileData数量设置" class="headerlink" title="1.1 页表和TileData数量设置"></a>1.1 页表和TileData数量设置</h4><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/5.webp"></p><h5 id="1-1-1-PageTable数量设置"><a href="#1-1-1-PageTable数量设置" class="headerlink" title="1.1.1 PageTable数量设置"></a>1.1.1 PageTable数量设置</h5><pre class="language-C++" data-language="C++"><code class="language-C++">页表的数量是分辨率内积直接得到, 而页表分辨率是默认构造FHeader时（用CreateInfo里的VirtualVolumeAABB等信息）计算, 每个页表元素是uint32
#define SPARSE_VOLUME_TILE_RES 16
PageTableVolumeResolution.xyz = VirtualVolumeSize.xyz / SPARSE_VOLUME_TILE_RES;
PageTableVolumeResolution.xyz = RoundUpToPowerOfTwo(PageTableVolumeResolution.xyz);</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/6.webp"></p><h5 id="1-1-2-TileData数量设置"><a href="#1-1-2-TileData数量设置" class="headerlink" title="1.1.2 TileData数量设置"></a>1.1.2 TileData数量设置</h5><pre class="language-C++" data-language="C++"><code class="language-C++">
TileDataA及TileDataB, 每个TileData是uint8
TileData数量 = 非空Tile数（即有效页数）* 每PaddedTile所含的Voxel数量 * 每Voxel所占用uint8的数量
每个PaddedTile的Voxel数量为
NumVoxelsPerPaddedTile = (16+2*1)*(16+2*1)*(16+2*1);
也就是SPARSE_VOLUME_TILE_RES+上下左右前后各自补一个Voxel
每个Voxel占的大小基于VDB导入设置里属性来
FormatSize[2] = {GPixelFormats[Header.AttributesFormats[0]].BlockBytes, GPixelFormats[Header.AttributesFormats[1]].BlockBytes}
若如下图导入配置, 则FormatSize[0] = 1Byte, FormatSize[1] = 0Byte
Tips: 不支持三通道属性, 若面板每属性配置3通道值, 该属性将占用4通道空间</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/7.webp"></p><h4 id="1-2-页表及TilesData的压缩-及存储流式数据"><a href="#1-2-页表及TilesData的压缩-及存储流式数据" class="headerlink" title="1.2 页表及TilesData的压缩, 及存储流式数据"></a>1.2 页表及TilesData的压缩, 及存储流式数据</h4><pre class="language-C++" data-language="C++"><code class="language-C++">FResource::Build方法中, 数据导入完成后, 先压缩数据进StreamableBulkData, 而后存储StreamableBulkData至StreamableMipLevels. (SparseVolumeTexture.cpp)</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/8.webp"></p><h5 id="1-2-1-页表的压缩"><a href="#1-2-1-页表的压缩" class="headerlink" title="1.2.1 页表的压缩"></a>1.2.1 页表的压缩</h5><pre class="language-C++" data-language="C++"><code class="language-C++">CompressPageTable方法, 压缩页表数据进StreamableBulkData
分配两倍非空页表线性连续空间M、N, M每空间用32bit存储三维坐标（X/Y/Z分别占用11/11/10位）, N每空间用32bit存储物理Tile的索引</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/9.webp"></p><h5 id="1-2-2-TileData的压缩"><a href="#1-2-2-TileData的压缩" class="headerlink" title="1.2.2 TileData的压缩"></a>1.2.2 TileData的压缩</h5><pre class="language-C++" data-language="C++"><code class="language-C++">CompressTiles方法, 压缩TileData进StreamableBulkData
先将默认FallbackValue从Vector4转成uint8值数组, 用于后续直接与PhysicalTileData数据比对, 过滤掉空Voxel

对非空Voxel全局索引按字（Word）编码成 Key = VIndex / 32, Value = 1u &lt;&lt; VIndex % 32
const int64 WordIndex = TileIndex * SVT::NumOccupancyWordsPerPaddedTile + (VoxelIndex / 32);
OccupancyBits[AttributesIdx][WordIndex] |= 1u &lt;&lt; (static_cast&lt;uint32&gt;(VoxelIndex) % 32u);

同时统计每Tile下非空Voxel数量
PrefixSums[AttributesIdx][TileIndex]++;</code></pre><pre class="language-C++" data-language="C++"><code class="language-C++">Tile非空体素统计及置位</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/10.webp"></p><pre class="language-C++" data-language="C++"><code class="language-C++">压缩所有非空Voxel数据</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/11.webp"></p><pre class="language-C++" data-language="C++"><code class="language-C++">压缩数据内存布局, 从左到右依次存储
OccupancyBits描述物理Volume全局体素非空置位表, 即非空的体素, 索引所在字（Word）, 并对其相应bit置位, bit的数量等同于所有Voxel包括非空的数量
TileDataOffsets描述Voxel数量偏移, 俩临近TileDataOffset差表示前一个TileData的非空Voxel数量
TileData描述每Voxel的密度、温度等数据</code></pre><table><thead><tr><th>OccupancyBits</th><th></th><th>TileDataOffsets</th><th></th><th>TileData</th><th></th></tr></thead><tbody><tr><td>OccupancyBitsOffset[0]</td><td>OccupancyBitsOffset[1]</td><td>TileDataOffsetsOffset[0]</td><td>TileDataOffsetsOffset[1]</td><td>TileDataOffset[0]</td><td>TileDataOffset[1]</td></tr><tr><td>OccupancyBitsSize[0]</td><td>OccupancyBitsSize[1]</td><td>TileDataOffsetsSize[0]</td><td>TileDataOffsetsSize[1]</td><td>TileDataSize[0]</td><td>TileDataSize[1]</td></tr></tbody></table><h5 id="1-2-3-存储流式数据"><a href="#1-2-3-存储流式数据" class="headerlink" title="1.2.3 存储流式数据"></a>1.2.3 存储流式数据</h5><pre class="language-C++" data-language="C++"><code class="language-C++">FResources::Cache（SparseVolumeTexture.cpp）保存磁盘前, 进一步压缩BulkData</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/12.webp"></p><h3 id="2-纹理"><a href="#2-纹理" class="headerlink" title="2. 纹理"></a>2. 纹理</h3><h4 id="2-1-数据更新至RHI"><a href="#2-1-数据更新至RHI" class="headerlink" title="2.1 数据更新至RHI"></a>2.1 数据更新至RHI</h4><pre class="language-C++" data-language="C++"><code class="language-C++">FStreamingManager::AddInternal方法（SparseVolumeTextureStreamingManager.cpp）中, 拷StreamableMipLevels数据, 通过RootTileUploader上传至CS, 以更新TileDataTextureRHI</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/13.webp"></p><h4 id="2-2-渲染页表及Tile纹理"><a href="#2-2-渲染页表及Tile纹理" class="headerlink" title="2.2 渲染页表及Tile纹理"></a>2.2 渲染页表及Tile纹理</h4><p>Shader文件 UpdateSparseVolumeTexture.usf</p><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/14.webp"></p><h4 id="2-3-采样页表及Tile纹理"><a href="#2-3-采样页表及Tile纹理" class="headerlink" title="2.3 采样页表及Tile纹理"></a>2.3 采样页表及Tile纹理</h4><p>用ComputeShader, 渲染至LightTexture<br><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/15.webp"><br><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/16.webp"><br>采样HeterogeneousVolumeRadiance纹理, 混合至SceneColor<br><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/17.webp"></p><h3 id="3-其他"><a href="#3-其他" class="headerlink" title="3. 其他"></a>3. 其他</h3><h4 id="UE5-3-SVT的一些限制"><a href="#UE5-3-SVT的一些限制" class="headerlink" title="UE5.3 SVT的一些限制"></a>UE5.3 SVT的一些限制</h4><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/18.webp"></p><p>页表纹理大小限制2GB内, SVT的X、Y值禁止超过32K, Z值禁止超过16K<br>这个通过上面的分析也好理解, 上面提到VDB的数据在UE5.3里是分Tile, 每Tile分辨率是<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.05ex" xmlns="http://www.w3.org/2000/svg" width="11.061ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 4888.9 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(1222.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1944.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(3166.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3888.9,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container>, 即<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="10.63ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 4698.5 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mo" transform="translate(1158.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(1881,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mo" transform="translate(3039.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(3762,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g></g></svg></mjx-container>， 且页表存储的数据X、Y维被压缩至11bit, Z维被压缩至10bit, 也就等同于Voxel的索引X、Y、Z维最大限制分别为32K（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="7.174ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 3171.1 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mo" transform="translate(1158.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(1881,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>）、32K（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="7.174ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 3171.1 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mo" transform="translate(1158.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(1881,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>）、16K（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="7.174ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 3171.1 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mo" transform="translate(1158.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="msup" transform="translate(1881,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g></g></g></g></g></svg></mjx-container>）.</p><h3 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a>4. 小结</h3><p>目前重心探索VDB的压缩存储方面, 具体渲染没过多深入, 一般镂空Voxel大概占比30%~50%<br>目前测试的数据不多, 动态的VDB暂没深究, 测试资产包网盘地址见 <span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWdkOVZIRi1wekxLNlhGUEhDUGduTmc/cHdkPWg3dm4=">CloudPackVDB<i class="fa fa-external-link-alt"></i></span></p><table><thead><tr><th align="center"></th><th align="center">压缩前[vdb]</th><th align="center">打包前[内部压缩]Mip0</th><th align="center">打包后[打包压缩, uasset]</th><th align="center">压缩比</th></tr></thead><tbody><tr><td align="center">静态云样例0</td><td align="center">19.2MB</td><td align="center">约10MB</td><td align="center">4.39MB</td><td align="center">22.86%</td></tr></tbody></table><pre class="language-C++" data-language="C++"><code class="language-C++">样例, 原始数据19.2MB, 截图为TileData及PageTable数据压缩后, 打包压缩前</code></pre><p><img data-src="https://cdn.laxdu.com/ImageHosting/V/VDB/19.webp"></p><h3 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h3><ol><li><span class="exturl" data-url="aHR0cHM6Ly93d3cub3BlbnZkYi5vcmcvZG9jdW1lbnRhdGlvbi9kb3h5Z2VuL292ZXJ2aWV3Lmh0bWw=">OpenVDB说明文档<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNS4zL2VuLVVTL3NwYXJzZS12b2x1bWUtdGV4dHVyZXMtaW4tdW5yZWFsLWVuZ2luZS8=">UE5.3 Sparse Volume Texture<i class="fa fa-external-link-alt"></i></span></li></ol></div><footer class="post-footer"><div class="license"><div class="license-title">UE 5.3 OpenVDB代码浅析</div><div class="license-link"><a href="https://blog.laxdu.com/posts/202401/">https://blog.laxdu.com/posts/202401/</a></div><div class="license-meta"><div class="license-meta-item"><div class="license-meta-title">本文作者</div><div class="license-meta-text">辰</div></div><div class="license-meta-item"><div class="license-meta-title">发布于</div><div class="license-meta-text">2024-01-30</div></div><div class="license-meta-item"><div class="license-meta-title">许可协议</div><div class="license-meta-text">禁止转载引用</div></div></div><div class="license-statement">如需转载或引用本文，请先获得作者授权！</div></div><div class="donation"><div class="donation-label">喜欢这篇文章？赞赏一下吧！</div><a class="donation-button" href="/donation/">赞赏作者</a></div><div class="post-tags"><a href="/tags/%E5%9B%BE%E5%BD%A2/" rel="tag"><i class="fa fa-tag"></i> 图形</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/202309/" rel="prev" title="深度学习 - TORCH"><i class="fa fa-angle-left"></i> 深度学习 - TORCH</a></div><div class="post-nav-item"><a href="/posts/202403/" rel="next" title="RTLTMPro">RTLTMPro <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments"><div id="twikoo-comments"></div></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><span class="exturl" data-url="aHR0cHM6Ly9iZWlhbi5taWl0Lmdvdi5jbg==">鄂ICP备2024062836号</span></div><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">辰</span></div><div class="busuanzi-count"></div><div class="footer-menu"><a href="/tags/">文章标签</a> · <a href="/policy/">网站政策</a> · <a href="/links/">友情链接</a></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script src="/js/third-party/fancybox.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="twikoo" type="application/json">{"enable":true,"visitor":false,"envId":"https://chenn9527-twikoo.hf.space","el":"#twikoo-comments"}</script><script>document.addEventListener("page:loaded",()=>{NexT.utils.loadComments(CONFIG.twikoo.el).then(()=>NexT.utils.getScript(CONFIG.twikoo.jsUrl||"https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js",{condition:window.twikoo})).then(()=>{twikoo.init(CONFIG.twikoo)})})</script><style>.comments,.post-block{overflow:visible}.tk-owo-emotion{display:inline-block}</style><script data-pjax type="text/javascript">var linkLists=document.querySelectorAll(".link-list");linkLists.forEach((function(n){var t=n.getAttribute("json-src"),a=n.getAttribute("icon-src"),e=new XMLHttpRequest;e.open("GET",t,!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=JSON.parse(e.responseText),s="";n.innerHTML="";for(var r=0;r<t.length;r++){var i=t[r],l=i.warn?'<span class="label warn">'+i.warn+"</span>":"",o=i.info?'<span class="label info">'+i.info+"</span>":"";s+='<div class="link-list-container">',s+='<img class="link-list-image" src="'+a+i.logo+'">',s+="<p>"+i.title+o+l+"</p>",s+="<p>"+i.intro+"</p>",s+='<a href="'+i.url+'" rel="noopener" target="_blank" data-pjax-state=""></a>',s+="</div>"}n.innerHTML=s}},e.send()}))</script><script data-pjax type="text/javascript">var leisureList=document.querySelectorAll(".leisure-list");if(0!==leisureList.length)for(var j=-1,i=0;i<leisureList.length;i++){const r=leisureList[i].getAttribute("json-src"),s=leisureList[i].getAttribute("cover-src");var xhr=new XMLHttpRequest;xhr.open("GET",r,!0),xhr.onreadystatechange=function(){if(4===xhr.readyState&&200===xhr.status){j++;var r=JSON.parse(xhr.responseText),e="";leisureList[j].innerHTML="";for(var t=0;t<r.length;t++){var i=r[t],a=i.title;i.pid&&(a='<a href="/posts/'+i.pid+'/">'+i.title+"</a>");var o=i.author?'<span class="author">'+i.author+"</span>":"",l=i.intro?i.intro:"",n="";if(null==i.score)n="";else{var c="",v="",u=Math.floor(i.score),d=0;i.score%1!=0&&(d=1);for(var h=0;h<u;h++)c+="★";0!==d&&(c+="☆");for(h=0;h<5-d-u;h++)v+="☆";n=5!==i.score?'<span class="star-score">'+c+'<span class="grey-star">'+v+"</span></span>":'<span class="star-score">'+c+"</span>"}e+='<div class="work">',e+='<div class="work-cover" style="background-image:url('+s+i.cover+')"></div>',e+='<div class="work-meta">',e+='<div class="work-meta-item title">'+a+"</div>",e+='<div class="work-meta-item">'+o+n+"</div>",e+='<div class="work-meta-item intro">'+l+"</div>",e+="</div></div>"}leisureList[j].innerHTML=e}},xhr.send()}</script></body></html>